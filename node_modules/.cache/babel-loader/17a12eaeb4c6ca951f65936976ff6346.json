{"ast":null,"code":"import \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\n\nvar _jsxFileName = \"/home/nhatnt/TN/FEcoffee/src/client/components/app-context/CheckoutProvider.jsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { useContext, createContext, useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport Tada from 'react-reveal/Tada';\nimport CheckCircleIcon from '@material-ui/icons/CheckCircle';\nimport { useCart } from './CartProvider';\nimport { SERVER_URL } from '../../../constants';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CheckoutContext = /*#__PURE__*/createContext();\nexport const useCheckout = () => {\n  _s();\n\n  return useContext(CheckoutContext);\n};\n\n_s(useCheckout, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nfunction CheckoutProvider({\n  children\n}) {\n  _s2();\n\n  const {\n    cartItems,\n    removeAllCartItems\n  } = useCart();\n  const [info, setInfo] = useState({});\n  const [order, setOrder] = useState();\n  const [coupon, setCoupon] = useState(0);\n  const [loadingSuccess, setLoadingSuccess] = useState(false);\n  const history = useHistory();\n  useEffect(() => {\n    let user = !sessionStorage.getItem('starbucks-member') ? {} : JSON.parse(sessionStorage.getItem('starbucks-member'));\n    setInfo({\n      recipientName: user.fullname,\n      orderAddress: user.address,\n      phone: user.phone,\n      user: {\n        id: user.id\n      }\n    });\n  }, []);\n\n  const saveInfo = values => {\n    setInfo({ ...values,\n      user: info.user\n    });\n\n    _message.success({\n      content: /*#__PURE__*/_jsxDEV(Tada, {\n        left: true,\n        children: \"Delivery information changed!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 29,\n        columnNumber: 13\n      }, this),\n      style: {\n        marginTop: '20vh',\n        fontSize: 16\n      },\n      icon: /*#__PURE__*/_jsxDEV(CheckCircleIcon, {\n        style: {\n          color: '#73d13d'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 34,\n        columnNumber: 10\n      }, this)\n    });\n  };\n\n  const saveCoupon = () => {\n    setCoupon(0);\n  };\n\n  const calculateSubtotal = () => {\n    let subtotal = 0;\n    cartItems.forEach(item => {\n      subtotal += item.total;\n    });\n    return parseFloat(subtotal.toFixed(2));\n  };\n\n  const convertCartToOrderDetails = () => {\n    return cartItems.map(item => {\n      return {\n        quantity: item.quantity,\n        note: item.note,\n        size: {\n          id: item.size.id\n        },\n        product: {\n          id: item.product.id\n        },\n        toppings: item.toppings.map(topping => {\n          return {\n            id: topping.id\n          };\n        })\n      };\n    });\n  };\n\n  const saveOrder = () => {\n    setLoadingSuccess(true);\n    setTimeout(() => {\n      setLoadingSuccess(false);\n      setOrder({ ...info,\n        details: convertCartToOrderDetails()\n      });\n      removeAllCartItems();\n      history.push('/success');\n    }, 1600);\n  };\n\n  useEffect(() => {\n    if (order !== undefined) {\n      const token = sessionStorage.getItem('starbucks-jwt');\n      fetch(SERVER_URL + '/order', {\n        method: 'POST',\n        headers: {\n          Authorization: token,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(order)\n      });\n    }\n  }, [order]);\n  useEffect(() => {\n    if (cartItems.length === 0 && order === undefined) {\n      history.push('/home');\n    }\n  }, [cartItems, order, history]);\n  return /*#__PURE__*/_jsxDEV(CheckoutContext.Provider, {\n    value: {\n      info,\n      coupon,\n      cartItems,\n      loadingSuccess,\n      saveInfo,\n      calculateSubtotal,\n      saveCoupon,\n      saveOrder\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 3\n  }, this);\n}\n\n_s2(CheckoutProvider, \"J17vnz9vrfcpbRZBJ5ppsPlA1YU=\", false, function () {\n  return [useCart, useHistory];\n});\n\n_c = CheckoutProvider;\nexport default CheckoutProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"CheckoutProvider\");","map":{"version":3,"sources":["/home/nhatnt/TN/FEcoffee/src/client/components/app-context/CheckoutProvider.jsx"],"names":["useContext","createContext","useState","useEffect","useHistory","Tada","CheckCircleIcon","useCart","SERVER_URL","CheckoutContext","useCheckout","CheckoutProvider","children","cartItems","removeAllCartItems","info","setInfo","order","setOrder","coupon","setCoupon","loadingSuccess","setLoadingSuccess","history","user","sessionStorage","getItem","JSON","parse","recipientName","fullname","orderAddress","address","phone","id","saveInfo","values","success","content","style","marginTop","fontSize","icon","color","saveCoupon","calculateSubtotal","subtotal","forEach","item","total","parseFloat","toFixed","convertCartToOrderDetails","map","quantity","note","size","product","toppings","topping","saveOrder","setTimeout","details","push","undefined","token","fetch","method","headers","Authorization","body","stringify","length"],"mappings":"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","sourcesContent":["import { useContext, createContext, useState, useEffect } from 'react';\nimport { message } from 'antd';\nimport { useHistory } from 'react-router-dom';\nimport Tada from 'react-reveal/Tada';\nimport CheckCircleIcon from '@material-ui/icons/CheckCircle';\nimport { useCart } from './CartProvider';\nimport { SERVER_URL } from '../../../constants';\n\nconst CheckoutContext = createContext();\n\nexport const useCheckout = () => useContext(CheckoutContext);\n\nfunction CheckoutProvider({ children }) {\n\tconst { cartItems, removeAllCartItems } = useCart();\n\tconst [info, setInfo] = useState({});\n\tconst [order, setOrder] = useState();\n\tconst [coupon, setCoupon] = useState(0);\n\tconst [loadingSuccess, setLoadingSuccess] = useState(false);\n\tconst history = useHistory();\n\n\tuseEffect(() => {\n\t\tlet user = !sessionStorage.getItem('starbucks-member') ? {} : JSON.parse(sessionStorage.getItem('starbucks-member'));\n\t\tsetInfo({ recipientName: user.fullname, orderAddress: user.address, phone: user.phone, user: { id: user.id } });\n\t}, []);\n\n\tconst saveInfo = (values) => {\n\t\tsetInfo({ ...values, user: info.user });\n\t\tmessage.success({\n\t\t\tcontent: <Tada left>Delivery information changed!</Tada>,\n\t\t\tstyle: {\n\t\t\t\tmarginTop: '20vh',\n\t\t\t\tfontSize: 16,\n\t\t\t},\n\t\t\ticon: <CheckCircleIcon style={{ color: '#73d13d' }} />,\n\t\t});\n\t};\n\n\tconst saveCoupon = () => {\n\t\tsetCoupon(0);\n\t};\n\n\tconst calculateSubtotal = () => {\n\t\tlet subtotal = 0;\n\t\tcartItems.forEach((item) => {\n\t\t\tsubtotal += item.total;\n\t\t});\n\t\treturn parseFloat(subtotal.toFixed(2));\n\t};\n\n\tconst convertCartToOrderDetails = () => {\n\t\treturn cartItems.map((item) => {\n\t\t\treturn {\n\t\t\t\tquantity: item.quantity,\n\t\t\t\tnote: item.note,\n\t\t\t\tsize: { id: item.size.id },\n\t\t\t\tproduct: { id: item.product.id },\n\t\t\t\ttoppings: item.toppings.map((topping) => {\n\t\t\t\t\treturn { id: topping.id };\n\t\t\t\t}),\n\t\t\t};\n\t\t});\n\t};\n\n\tconst saveOrder = () => {\n\t\tsetLoadingSuccess(true);\n\t\tsetTimeout(() => {\n\t\t\tsetLoadingSuccess(false);\n\t\t\tsetOrder({ ...info, details: convertCartToOrderDetails() });\n\t\t\tremoveAllCartItems();\n\t\t\thistory.push('/success');\n\t\t}, 1600);\n\t};\n\n\tuseEffect(() => {\n\t\tif (order !== undefined) {\n\t\t\tconst token = sessionStorage.getItem('starbucks-jwt');\n\t\t\tfetch(SERVER_URL + '/order', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: token,\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify(order),\n\t\t\t});\n\t\t}\n\t}, [order]);\n\n\tuseEffect(() => {\n\t\tif (cartItems.length === 0 && order === undefined) {\n\t\t\thistory.push('/home');\n\t\t}\n\t}, [cartItems, order, history]);\n\n\treturn (\n\t\t<CheckoutContext.Provider value={{ info, coupon, cartItems, loadingSuccess, saveInfo, calculateSubtotal, saveCoupon, saveOrder }}>\n\t\t\t{children}\n\t\t</CheckoutContext.Provider>\n\t);\n}\n\nexport default CheckoutProvider;\n"]},"metadata":{},"sourceType":"module"}