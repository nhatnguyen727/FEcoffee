{"ast":null,"code":"var _jsxFileName = \"/home/nhatnt/TN/FEcoffee/src/client/components/app-context/ProductProvider.jsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { useContext, createContext, useState, useEffect, useMemo } from 'react';\nimport { useCategories } from './CategoryProvider';\nimport { SERVER_URL } from '../../../constants';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ProductContext = /*#__PURE__*/createContext();\nexport const useProducts = () => {\n  _s();\n\n  return useContext(ProductContext);\n};\n\n_s(useProducts, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nfunction ProductProvider({\n  children\n}) {\n  _s2();\n\n  const {\n    selectedCategory\n  } = useCategories();\n  const [products, setProducts] = useState([]);\n  const [productLoading, setProductLoading] = useState(false);\n  const [favorites, setFavorites] = useState([]);\n  useEffect(() => {\n    setProductLoading(true);\n    fetch(SERVER_URL + `/product/category=${selectedCategory.id}`).then(response => response.json()).then(setProducts).then(() => setProductLoading(false));\n  }, [selectedCategory.id]);\n  useMemo(() => {\n    if (localStorage.getItem('starbucks-favorite') === null) {\n      localStorage.setItem('starbucks-favorite', JSON.stringify([])); // initial favorites in localStorage\n    }\n\n    if (sessionStorage.getItem('starbucks-member') !== null) {\n      let userId = JSON.parse(sessionStorage.getItem('starbucks-member')).id;\n      const token = sessionStorage.getItem('starbucks-jwt');\n      fetch(SERVER_URL + `/favorite/user=${userId}`, {\n        headers: {\n          Authorization: token\n        }\n      }).then(response => response.json()).then(result => {\n        setFavorites(result.products);\n        localStorage.setItem('starbucks-favorite', JSON.stringify(result.products));\n      });\n    }\n  }, []);\n\n  const updateFavorite = (id, favoriteTicked) => {\n    // for animation of favorite button works smooth, we don't use state here because it causes rendering the product list,\n    // therefore, it makes the animation delayed\n    let favoritesLocal = localStorage.getItem('starbucks-favorite') !== [] ? JSON.parse(localStorage.getItem('starbucks-favorite')) : []; // update in localStorage\n\n    favoriteTicked ? localStorage.setItem('starbucks-favorite', JSON.stringify([...favoritesLocal, {\n      id: id\n    }])) : localStorage.setItem('starbucks-favorite', JSON.stringify(favoritesLocal.filter(fav => fav.id !== id))); // update in database\n\n    if (sessionStorage.getItem('starbucks-member') !== null) {\n      let userId = JSON.parse(sessionStorage.getItem('starbucks-member')).id;\n      let favProducts = favoriteTicked ? {\n        id: userId,\n        products: [...favoritesLocal, {\n          id: id\n        }]\n      } : {\n        id: userId,\n        products: favoritesLocal.filter(fav => fav.id !== id)\n      };\n      const token = sessionStorage.getItem('starbucks-jwt');\n      fetch(SERVER_URL + `/favorite/user=${userId}`, {\n        method: 'PUT',\n        headers: {\n          Authorization: token,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(favProducts)\n      });\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(ProductContext.Provider, {\n    value: {\n      products,\n      productLoading,\n      favorites,\n      updateFavorite\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 9\n  }, this);\n}\n\n_s2(ProductProvider, \"NmwurcdShBY9Gzt0jVjVR+8A1kg=\", false, function () {\n  return [useCategories];\n});\n\n_c = ProductProvider;\nexport default ProductProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"ProductProvider\");","map":{"version":3,"sources":["/home/nhatnt/TN/FEcoffee/src/client/components/app-context/ProductProvider.jsx"],"names":["useContext","createContext","useState","useEffect","useMemo","useCategories","SERVER_URL","ProductContext","useProducts","ProductProvider","children","selectedCategory","products","setProducts","productLoading","setProductLoading","favorites","setFavorites","fetch","id","then","response","json","localStorage","getItem","setItem","JSON","stringify","sessionStorage","userId","parse","token","headers","Authorization","result","updateFavorite","favoriteTicked","favoritesLocal","filter","fav","favProducts","method","body"],"mappings":"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","sourcesContent":["import { useContext, createContext, useState, useEffect, useMemo } from 'react';\nimport { useCategories } from './CategoryProvider';\nimport { SERVER_URL } from '../../../constants';\n\nconst ProductContext = createContext();\n\nexport const useProducts = () => useContext(ProductContext);\n\nfunction ProductProvider({ children }) {\n\tconst { selectedCategory } = useCategories();\n\tconst [products, setProducts] = useState([]);\n\tconst [productLoading, setProductLoading] = useState(false);\n\tconst [favorites, setFavorites] = useState([]);\n\n\tuseEffect(() => {\n\t\tsetProductLoading(true);\n\t\tfetch(SERVER_URL + `/product/category=${selectedCategory.id}`)\n\t\t\t.then((response) => response.json())\n\t\t\t.then(setProducts)\n\t\t\t.then(() => setProductLoading(false));\n\t}, [selectedCategory.id]);\n\n\tuseMemo(() => {\n\t\tif (localStorage.getItem('starbucks-favorite') === null) {\n\t\t\tlocalStorage.setItem('starbucks-favorite', JSON.stringify([])); // initial favorites in localStorage\n\t\t}\n\t\tif (sessionStorage.getItem('starbucks-member') !== null) {\n\t\t\tlet userId = JSON.parse(sessionStorage.getItem('starbucks-member')).id;\n\t\t\tconst token = sessionStorage.getItem('starbucks-jwt');\n\t\t\tfetch(SERVER_URL + `/favorite/user=${userId}`, {\n\t\t\t\theaders: { Authorization: token },\n\t\t\t})\n\t\t\t\t.then((response) => response.json())\n\t\t\t\t.then((result) => {\n\t\t\t\t\tsetFavorites(result.products);\n\t\t\t\t\tlocalStorage.setItem('starbucks-favorite', JSON.stringify(result.products));\n\t\t\t\t});\n\t\t}\n\t}, []);\n\n\tconst updateFavorite = (id, favoriteTicked) => {\n\t\t// for animation of favorite button works smooth, we don't use state here because it causes rendering the product list,\n\t\t// therefore, it makes the animation delayed\n\t\tlet favoritesLocal = localStorage.getItem('starbucks-favorite') !== [] ? JSON.parse(localStorage.getItem('starbucks-favorite')) : [];\n\t\t// update in localStorage\n\t\tfavoriteTicked\n\t\t\t? localStorage.setItem('starbucks-favorite', JSON.stringify([...favoritesLocal, { id: id }]))\n\t\t\t: localStorage.setItem('starbucks-favorite', JSON.stringify(favoritesLocal.filter((fav) => fav.id !== id)));\n\t\t// update in database\n\t\tif (sessionStorage.getItem('starbucks-member') !== null) {\n\t\t\tlet userId = JSON.parse(sessionStorage.getItem('starbucks-member')).id;\n\t\t\tlet favProducts = favoriteTicked\n\t\t\t\t? { id: userId, products: [...favoritesLocal, { id: id }] }\n\t\t\t\t: { id: userId, products: favoritesLocal.filter((fav) => fav.id !== id) };\n\t\t\tconst token = sessionStorage.getItem('starbucks-jwt');\n\t\t\tfetch(SERVER_URL + `/favorite/user=${userId}`, {\n\t\t\t\tmethod: 'PUT',\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: token,\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify(favProducts),\n\t\t\t});\n\t\t}\n\t};\n\n\treturn <ProductContext.Provider value={{ products, productLoading, favorites, updateFavorite }}>{children}</ProductContext.Provider>;\n}\n\nexport default ProductProvider;\n"]},"metadata":{},"sourceType":"module"}